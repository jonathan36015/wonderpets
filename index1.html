<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Wonder Pets Family Management System</title>
<style>
  /* ... (your existing styles) ... */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #a8e063, #56ab2f);
    background-size: 400% 400%;
    animation: gradientAnim 15s ease infinite;
    color: #fff;
  }

  @keyframes gradientAnim {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  header {
    background-color: rgba(0,0,0,0.3);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  header h1 {
    margin: 0;
  }

  nav a {
    margin: 0 10px;
    color: #fff;
    text-decoration: none;
    font-weight: bold;
  }

  nav a.active {
    text-decoration: underline;
  }

  main {
    padding: 20px;
  }

  .section {
    display: none;
  }

  .section.active {
    display: block;
  }

  /* Show/hide add client form */
  #addClientContainer {
    display: none; /* Hidden initially */
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background-color: rgba(255,255,255,0.1);
  }

  th, td {
    border: 1px solid #fff;
    padding: 8px;
    text-align: left;
  }

  th {
    background-color: rgba(0,0,0,0.2);
  }

  input[type="text"], input[type="number"] {
    padding: 5px;
    margin: 5px 0;
    width: calc(100% - 12px);
  }

  button {
    padding: 8px 12px;
    margin-top: 10px;
    cursor: pointer;
    background-color: #fff;
    color: #56ab2f;
    border: none;
    border-radius: 4px;
    font-weight: bold;
  }

  button:hover {
    background-color: #ddd;
  }
</style>
</head>
<body>

<header>
  <h1>Wonder pets FamilyManagement System</h1>
  <nav>
    <a href="#" id="nav-clientlist" class="active">Member List</a>
    <a href="#" id="nav-addclient">Add WP member</a>
    <a href="#" id="nav-transaction">Transactions</a>
    <a href="#" id="nav-statements">Statements</a>
  </nav>
</header>

<main>
  <!-- Client List Section -->
  <section id="section-clientlist" class="section active">
    <h2>Member List</h2>
    <table id="clientsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Purpose</th>
          <th>Id number</th>
          <th>Email</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Add Client Section -->
  <section id="section-addclient" class="section">
    <!-- We'll use a container to toggle visibility -->
    <div id="addClientContainer">
      <h2>Add WP member</h2>
      <form id="addClientForm">
        <label>Name:</label><br>
        <input type="text" id="clientName" required><br>
        <label>Purpose:</label><br>
        <input type="text" id="clientAddress" ><br>
        <label>Id number:</label><br>
        <input type="text" id="clientPhone" required><br>
        <label>Email:</label><br>
        <label><em>(optional:)</em></label>
        <input type="text" id="clientEmail"><br>
        <button type="submit">Add WP member</button>
      </form>
    </div>
  </section>

  <!-- Transaction Section -->
  <section id="section-transaction" class="section">
    <h2>Transactions</h2>
    <form id="transactionForm">
      <label>Select Client:</label><br>
      <select id="transactionClientSelect" required></select><br>
      <label>Description:</label><br>
      <input type="text" id="transactionDescription" required><br>
      <label>Amount:</label><br>
      <input type="number" id="transactionAmount" required><br>
      <button type="submit">Add Transaction</button>
    </form>
  </section>

  <!-- Statements Section -->
  <section id="section-statements" class="section">
    <h2>Statements</h2>
    <div id="statementContainer" style="white-space: pre-wrap; background:#fff; color:#000; padding:10px; border-radius:5px; max-height:400px; overflow:auto;"></div>
    <button id="printStatement" style="margin-top:10px;">Print Statement</button>
  </section>
</main>

<script>
  // Variables
  let isLoggedIn = false;

  // Load clients
  function loadClients() {
    const clients = localStorage.getItem('clients');
    return clients ? JSON.parse(clients) : [];
  }

  function saveClients(clients) {
    localStorage.setItem('clients', JSON.stringify(clients));
  }

  // Navigation setup
  const sections = {
    'clientlist': document.getElementById('section-clientlist'),
    'addclient': document.getElementById('section-addclient'),
    'transaction': document.getElementById('section-transaction'),
    'statements': document.getElementById('section-statements')
  };

  const navLinks = {
    'clientlist': document.getElementById('nav-clientlist'),
    'addclient': document.getElementById('nav-addclient'),
    'transaction': document.getElementById('nav-transaction'),
    'statements': document.getElementById('nav-statements')
  };

  function showSection(sectionId) {
    for (let key in sections) {
      sections[key].classList.toggle('active', key === sectionId);
    }
    // On client list, load data
    if (sectionId === 'clientlist') {
      loadClientTable();
    } else if (sectionId === 'transaction') {
      populateClientSelect();
    }
  }

  // Navigation click handlers
  for (let key in navLinks) {
    navLinks[key].addEventListener('click', (e) => {
      e.preventDefault();
      // Show the section
      showSection(key);
      // Special handling for Add Client
      if (key === 'addclient') {
        promptLoginForAddClient();
      }
    });
  }

  // Function to prompt login before showing add client form
  function promptLoginForAddClient() {
    if (!isLoggedIn) {
      const username = prompt('Enter username:');
      const password = prompt('Enter password:');

      const adminCredentials = {
        username: 'admin',
        password: 'password123'
      };

      if (username === adminCredentials.username && password === adminCredentials.password) {
        isLoggedIn = true;
        // Show the form
        document.getElementById('addClientContainer').style.display = 'block';
      } else {
        alert('Invalid credentials. Access denied.');
        // Hide the add client section if not logged in
        document.getElementById('addClientContainer').style.display = 'none';
        // Optionally, switch back to client list
        showSection('clientlist');
      }
    } else {
      // Already logged in
      document.getElementById('addClientContainer').style.display = 'block';
    }
  }

  // When user clicks on the Add Client tab, trigger the login prompt
  // (Handled above in nav click event)

  // Load client table
function loadClientTable() {
  const clients = loadClients();
  const tbody = document.querySelector('#clientsTable tbody');
  tbody.innerHTML = '';
  clients.forEach((c, index) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${c.name}</td>
      <td>${c.address}</td>
      <td>${c.phone}</td>
      <td>${c.email}</td>
      <td>
        <button onclick="viewHistory(${index})">View History</button>
        <button onclick="deleteClient(${index})">Delete Client</button>
        <button onclick="deleteHistory(${index})">Delete History</button>
        <button onclick="generateStatement(${index})">Generate Statement</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

// Delete client
function deleteClient(index) {
  if (confirm('Are you sure you want to delete this client?')) {
    const clients = loadClients();
    clients.splice(index, 1);
    saveClients(clients);
    loadClientTable();
  }
}

// Add client form submit
document.getElementById('addClientForm').addEventListener('submit', (e) => {
  e.preventDefault();

  if (!isLoggedIn) {
    alert('Please login before adding clients.');
    promptLoginForAddClient();
    return;
  }

  // Proceed to add client
  const newClient = {
    name: document.getElementById('clientName').value,
    address: document.getElementById('clientAddress').value,
    phone: document.getElementById('clientPhone').value,
    email: document.getElementById('clientEmail').value,
    history: []
  };
  const clients = loadClients();
  clients.push(newClient);
  saveClients(clients);
  alert('Client added successfully!');
  document.getElementById('addClientForm').reset();
  showSection('clientlist');
});

// Populate client select for transactions
function populateClientSelect() {
  const select = document.getElementById('transactionClientSelect');
  select.innerHTML = '';
  const clients = loadClients();
  clients.forEach((c, index) => {
    const option = document.createElement('option');
    option.value = index;
    option.textContent = c.name;
    select.appendChild(option);
  });
}

// Handle transaction form
document.getElementById('transactionForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const clientIndex = parseInt(document.getElementById('transactionClientSelect').value);
  const description = document.getElementById('transactionDescription').value;
  const amount = parseFloat(document.getElementById('transactionAmount').value);
  const clients = loadClients();
  if (clients[clientIndex]) {
    const transaction = {
      date: new Date().toLocaleString(),
      description: description,
      amount: amount
    };
    if (!clients[clientIndex].history) {
      clients[clientIndex].history = [];
    }
    clients[clientIndex].history.push(transaction);
    saveClients(clients);
    alert('Transaction added successfully!');
    document.getElementById('transactionForm').reset();
  } else {
    alert('Client not found!');
  }
});

// View history
function viewHistory(clientIndex) {
  const clients = loadClients();
  const client = clients[clientIndex];
  if (!client || !client.history || client.history.length === 0) {
    alert('No transaction history available for this client.');
    return;
  }
  let html = `
    <h3>Transaction History for ${client.name}</h3>
    <table>
      <thead>
        <tr><th>Date</th><th>Description</th><th>Amount</th></tr>
      </thead>
      <tbody>
  `;
  client.history.forEach(t => {
    html += `
      <tr>
        <td>${t.date}</td>
        <td>${t.description}</td>
        <td>${t.amount}</td>
      </tr>
    `;
  });
  html += `
      </tbody>
    </table>
  `;
  const newWin = window.open('', '_blank');
  newWin.document.write('<html><head><title>Transaction History</title></head><body>');
  newWin.document.write(html);
  newWin.document.write('</body></html>');
}

// Delete history
function deleteHistory(clientIndex) {
  if (confirm("Are you sure you want to delete this client's transaction history?")) {
    const clients = loadClients();
    if (clients[clientIndex]) {
      clients[clientIndex].history = [];
      saveClients(clients);
      alert('Transaction history deleted.');
    }
  }
}

// Generate Statement
function generateStatement(clientIndex) {
  const clients = loadClients();
  const client = clients[clientIndex];
  if (!client || !client.history || client.history.length === 0) {
    alert('No transactions to generate statement.');
    return;
  }
  let statement = `Statement for ${client.name}\n\n`;
  statement += `Date\tDescription\tAmount\n`;
  let total = 0;
  client.history.forEach(t => {
    statement += `${t.date}\t${t.description}\t${t.amount}\n`;
    total += t.amount;
  });
  statement += `\nTotal: ${total}\n`;
  document.getElementById('statementContainer').textContent = statement;
  document.getElementById('printStatement').setAttribute('data-client-index', clientIndex);
  showSection('statements');
}

// Print statement
document.getElementById('printStatement').addEventListener('click', () => {
  const statementDiv = document.getElementById('statementContainer');
  const printWindow = window.open('', '_blank');
  printWindow.document.write('<pre>' + statementDiv.textContent + '</pre>');
  printWindow.document.close();
  printWindow.print();
});

// Initialize on load
window.onload = () => {
  loadClientTable();
};
</script>
</body>
</html>